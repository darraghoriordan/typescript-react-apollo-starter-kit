{"version":3,"file":"../../main.server.js","sources":["webpack:///webpack/bootstrap 89bd5c79af8aed28246c","webpack:///external \"react\"","webpack:///external \"react-router-redux\"","webpack:///./config.ts","webpack:///external \"redux\"","webpack:///./components/Html/index.tsx","webpack:///./redux/configureStore.ts","webpack:///./redux/intl/actions.ts","webpack:///./redux/runtime/actions.ts","webpack:///./routes/index.tsx","webpack:///./schema/index.ts","webpack:///external \"body-parser\"","webpack:///external \"cookie-parser\"","webpack:///external \"express\"","webpack:///external \"express-graphql\"","webpack:///external \"express-jwt\"","webpack:///external \"helmet\"","webpack:///external \"jsonwebtoken\"","webpack:///external \"mongoose\"","webpack:///external \"passport\"","webpack:///external \"path\"","webpack:///external \"pretty-error\"","webpack:///external \"react-dom/server\"","webpack:///external \"react-redux\"","webpack:///external \"react-router\"","webpack:///./components/App/index.tsx","webpack:///./redux/createHelpers.ts","webpack:///./redux/intl/constants.ts","webpack:///./redux/logger.ts","webpack:///./redux/reducers.ts","webpack:///./redux/runtime/constants.ts","webpack:///./routes/Home/Home.tsx","webpack:///./routes/Home/index.tsx","webpack:///./routes/NotFound/NotFound.tsx","webpack:///./routes/NotFound/index.tsx","webpack:///external \"graphql\"","webpack:///external \"react-helmet\"","webpack:///external \"redux-logger\"","webpack:///external \"redux-thunk\"","webpack:///./main.server.tsx","webpack:///./routes/Error/ErrorPage.tsx"],"sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId])\n \t\t\treturn installedModules[moduleId].exports;\n\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// identity function for calling harmony imports with the correct context\n \t__webpack_require__.i = function(value) { return value; };\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, {\n \t\t\t\tconfigurable: false,\n \t\t\t\tenumerable: true,\n \t\t\t\tget: getter\n \t\t\t});\n \t\t}\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"/assets/\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 38);\n\n\n\n// WEBPACK FOOTER //\n// webpack/bootstrap 89bd5c79af8aed28246c","module.exports = require(\"react\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"react\"\n// module id = 0\n// module chunks = 0","module.exports = require(\"react-router-redux\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"react-router-redux\"\n// module id = 1\n// module chunks = 0","export const port = process.env.PORT || 3000;\r\nexport const host = process.env.WEBSITE_HOSTNAME || `localhost:${port}`;\r\n\r\n// default locale is the first one\r\nexport const locales = ['en-US', 'cs-CZ'];\r\n\r\nexport const analytics = {\r\n\r\n  // https://analytics.google.com/\r\n  google: {\r\n    trackingId: 'UA-64309227-1',\r\n  },\r\n\r\n};\r\n\r\nexport const auth = {\r\n\r\n  jwt: { secret: process.env.JWT_SECRET || 'React Starter Kit' },\r\n\r\n  // https://developers.facebook.com/\r\n  facebook: {\r\n    id: process.env.FACEBOOK_APP_ID || '186244551745631',\r\n    secret: process.env.FACEBOOK_APP_SECRET || 'a970ae3240ab4b9b8aae0f9f0661c6fc',\r\n  },\r\n\r\n  // https://cloud.google.com/console/project\r\n  google: {\r\n    id: process.env.GOOGLE_CLIENT_ID || '251410730550-ahcg0ou5mgfhl8hlui1urru7jn5s12km.apps.googleusercontent.com',\r\n    secret: process.env.GOOGLE_CLIENT_SECRET || 'Y8yR9yZAhm9jQ8FKAL8QIEcd',\r\n  },\r\n\r\n  // https://apps.twitter.com/\r\n  twitter: {\r\n    key: process.env.TWITTER_CONSUMER_KEY || 'Ie20AZvLJI2lQD5Dsgxgjauns',\r\n    secret: process.env.TWITTER_CONSUMER_SECRET || 'KTZ6cxoKnEakQCeSpZlaUCJWGAlTEBJj0y2EMkUBujA7zWSvaQ',\r\n  },\r\n\r\n};\r\n\n\n\n// WEBPACK FOOTER //\n// ./config.ts","module.exports = require(\"redux\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"redux\"\n// module id = 3\n// module chunks = 0","import * as React from 'react';\r\nimport * as Helmet from 'react-helmet';\r\nimport { analytics } from '../../config';\r\n\r\nexport interface IHtmlProps extends React.Props<any> {\r\n  title: string;\r\n  description: string;\r\n  children?: string;\r\n  state?: any;\r\n}\r\n\r\nconst Html: React.StatelessComponent<IHtmlProps> = ({ title, description, children, state }) => {\r\n  const head = Helmet.rewind();\r\n  return (<html className=\"no-js\">\r\n    <head>\r\n      {head.base.toComponent()}\r\n      {head.title.toComponent()}\r\n      {head.meta.toComponent()}\r\n      {head.link.toComponent()}\r\n      {head.script.toComponent()}\r\n\r\n      <meta charSet=\"utf-8\" />\r\n      <meta httpEquiv=\"x-ua-compatible\" content=\"ie=edge\" />\r\n      <meta name=\"description\" content={description} />\r\n      <meta name=\"viewport\" content=\"width=device-width, initial-scale=1\" />\r\n      <link rel=\"apple-touch-icon\" href=\"apple-touch-icon.png\" />\r\n    </head>\r\n    <body>\r\n      <div id=\"app\" dangerouslySetInnerHTML={{ __html: children }} />\r\n      {state && (\r\n        <script\r\n          dangerouslySetInnerHTML={{ __html:\r\n          `window.__INITIAL_STATE__=${JSON.stringify(state)}` }}\r\n        />\r\n      )}\r\n      <script defer src=\"/assets/vendor.js\"></script>\r\n      <script defer src=\"/assets/client.js\"></script>\r\n      {analytics.google.trackingId && (\r\n        <script\r\n          dangerouslySetInnerHTML={{ __html:\r\n          'window.ga=function(){ga.q.push(arguments)};ga.q=[];ga.l=+new Date;' +\r\n          `ga('create','${analytics.google.trackingId}','auto');ga('send','pageview')` }}\r\n        />\r\n      )}\r\n      {analytics.google.trackingId && (\r\n        <script src=\"https://www.google-analytics.com/analytics.js\" async defer />\r\n      )}\r\n    </body>\r\n  </html>);\r\n};\r\n\r\nexport default Html;\r\n\n\n\n// WEBPACK FOOTER //\n// ./components/Html/index.tsx","import { routerMiddleware } from 'react-router-redux';\r\nimport * as Redux from 'redux';\r\nimport { applyMiddleware, compose, createStore as _createStore } from 'redux';\r\nimport thunk from 'redux-thunk';\r\nimport createHelpers from './createHelpers';\r\nimport { IState } from './IState';\r\nimport logger from './logger';\r\nimport { createReducer, injectAsyncReducer } from './reducers';\r\n\r\ninterface IStore extends Redux.Store<any> {\r\n  asyncReducers?: any;\r\n  injectAsyncReducer?: (store, name, asyncReducer) => void;\r\n}\r\n\r\ninterface IHelperConfig {\r\n  history: any;\r\n  cookie?: any;\r\n}\r\n\r\nexport function configureStore(initialState: IState, helpersConfig?: IHelperConfig): Redux.Store<any> {\r\n  let middleware: Redux.Middleware[] = [\r\n    routerMiddleware(helpersConfig.history),\r\n    thunk.withExtraArgument(createHelpers(helpersConfig)),\r\n  ];\r\n\r\n  if (process.env.NODE_ENV === 'development' && process.env.BROWSER) {\r\n    middleware = [...middleware, logger];\r\n  }\r\n\r\n  const composeEnhancers = (process.env.NODE_ENV === 'development' &&\r\n    typeof window === 'object' &&\r\n    window.__REDUX_DEVTOOLS_EXTENSION_COMPOSE__) || compose;\r\n\r\n  const store: IStore = _createStore(\r\n    createReducer(),\r\n    initialState,\r\n    composeEnhancers(\r\n      applyMiddleware(...middleware),\r\n    ),\r\n  );\r\n\r\n  store.asyncReducers = {};\r\n  store.injectAsyncReducer = injectAsyncReducer.bind(null, store);\r\n\r\n  if (process.env.NODE_ENV === 'development' && (module as any).hot) {\r\n    (module as any).hot.accept('./reducers', () => {\r\n      store.replaceReducer((require('./reducers')));\r\n    });\r\n  }\r\n\r\n  return store;\r\n};\r\n\n\n\n// WEBPACK FOOTER //\n// ./redux/configureStore.ts","import {\r\n  SET_LOCALE_ERROR,\r\n  SET_LOCALE_START,\r\n  SET_LOCALE_SUCCESS,\r\n} from './constants';\r\n\r\nconst query = `\r\n  query ($locale:String!) {\r\n    intl (locale:$locale) {\r\n      id\r\n      message\r\n    }\r\n  }\r\n`;\r\n\r\nexport function setLocale({ locale }) {\r\n  return async (dispatch, getState, { graphqlRequest }) => {\r\n    dispatch({\r\n      type: SET_LOCALE_START,\r\n      payload: {\r\n        locale,\r\n      },\r\n    });\r\n\r\n    try {\r\n      const { data } = await graphqlRequest(query, { locale });\r\n      const messages = data.intl.reduce((msgs, msg) => {\r\n        msgs[msg.id] = msg.message; // eslint-disable-line no-param-reassign\r\n        return msgs;\r\n      }, {});\r\n      dispatch({\r\n        type: SET_LOCALE_SUCCESS,\r\n        payload: {\r\n          locale,\r\n          messages,\r\n        },\r\n      });\r\n\r\n      // remember locale for every new request\r\n      if (process.env.BROWSER) {\r\n        const maxAge = 3650 * 24 * 3600; // 10 years in seconds\r\n        document.cookie = `lang=${locale};path=/;max-age=${maxAge}`;\r\n      }\r\n    } catch (error) {\r\n      dispatch({\r\n        type: SET_LOCALE_ERROR,\r\n        payload: {\r\n          locale,\r\n          error,\r\n        },\r\n      });\r\n      return false;\r\n    }\r\n\r\n    return true;\r\n  };\r\n}\r\n\n\n\n// WEBPACK FOOTER //\n// ./redux/intl/actions.ts","import { SET_RUNTIME_VARIABLE } from './constants';\r\n\r\nexport function setRuntimeVariable({ name, value }) {\r\n  return {\r\n    type: SET_RUNTIME_VARIABLE,\r\n    payload: {\r\n      name,\r\n      value,\r\n    },\r\n  };\r\n}\r\n\n\n\n// WEBPACK FOOTER //\n// ./redux/runtime/actions.ts","import * as React from 'react';\r\nimport { IndexRoute, Route } from 'react-router';\r\nimport App from '../components/App';\r\nimport HomeRoute from './Home';\r\nimport NotFoundRoute from './NotFound';\r\n\r\n/*declare const System: any;\r\nif (typeof System.import === 'undefined') {\r\n  System.import = (module) => Promise.resolve(require(module));\r\n}*/\r\n\r\nexport default (store) => {\r\n  return {\r\n    path: '/',\r\n    getComponent (nextState, cb) {\r\n      cb(null, App);\r\n    },\r\n    indexRoute: HomeRoute,\r\n    childRoutes: [\r\n      NotFoundRoute,\r\n    ],\r\n  };\r\n};\r\n\r\n// export default (store) => {\r\n//   return (\r\n//     <Route path=\"/\" component={App}>\r\n//       {/* Home (main) route */}\r\n//       <IndexRoute component={Home} />\r\n\r\n//       {/* Catch all route */}\r\n//       <Route path=\"*\" component={NotFound} status={404} />\r\n//     </Route>\r\n//   );\r\n// };\r\n\n\n\n// WEBPACK FOOTER //\n// ./routes/index.tsx","import { buildSchema, GraphQLSchema } from 'graphql';\r\n\r\nconst schema: GraphQLSchema = buildSchema(`\r\n  type Query {\r\n    hello: String\r\n  }\r\n`);\r\n\r\nconst root = {\r\n  hello: () => {\r\n    return 'Hello world!';\r\n  },\r\n};\r\n\r\nexport { root, schema };\r\n\n\n\n// WEBPACK FOOTER //\n// ./schema/index.ts","module.exports = require(\"body-parser\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"body-parser\"\n// module id = 10\n// module chunks = 0","module.exports = require(\"cookie-parser\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"cookie-parser\"\n// module id = 11\n// module chunks = 0","module.exports = require(\"express\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"express\"\n// module id = 12\n// module chunks = 0","module.exports = require(\"express-graphql\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"express-graphql\"\n// module id = 13\n// module chunks = 0","module.exports = require(\"express-jwt\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"express-jwt\"\n// module id = 14\n// module chunks = 0","module.exports = require(\"helmet\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"helmet\"\n// module id = 15\n// module chunks = 0","module.exports = require(\"jsonwebtoken\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"jsonwebtoken\"\n// module id = 16\n// module chunks = 0","module.exports = require(\"mongoose\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"mongoose\"\n// module id = 17\n// module chunks = 0","module.exports = require(\"passport\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"passport\"\n// module id = 18\n// module chunks = 0","module.exports = require(\"path\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"path\"\n// module id = 19\n// module chunks = 0","module.exports = require(\"pretty-error\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"pretty-error\"\n// module id = 20\n// module chunks = 0","module.exports = require(\"react-dom/server\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"react-dom/server\"\n// module id = 21\n// module chunks = 0","module.exports = require(\"react-redux\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"react-redux\"\n// module id = 22\n// module chunks = 0","module.exports = require(\"react-router\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"react-router\"\n// module id = 23\n// module chunks = 0","import * as React from 'react';\r\n\r\nclass App extends React.Component<any, any> {\r\n  public static propTypes = {\r\n    children: React.PropTypes.node,\r\n  };\r\n\r\n  public render() {\r\n    return (\r\n      <div>\r\n        <h1>Hello World!</h1>\r\n        {this.props.children}\r\n      </div>\r\n    );\r\n  }\r\n}\r\n\r\nexport default App;\r\n\n\n\n// WEBPACK FOOTER //\n// ./components/App/index.tsx","interface IConfig {\r\n  method?: string;\r\n  headers?: {\r\n    [key: string]: string,\r\n  }\r\n  body?: string;\r\n  credentials?: string;\r\n}\r\n\r\nfunction fetch(url, config: IConfig) {\r\n  return new Promise<any> ((resolve, reject) => {\r\n    const request = new XMLHttpRequest();\r\n    request.open(config.method, url);\r\n\r\n    Object.keys(config.headers).forEach((header) => {\r\n      request.setRequestHeader(header, config.headers[header]);\r\n    });\r\n    request.withCredentials = true;\r\n\r\n    request.onload = () => {\r\n      if (request.status === 200) {\r\n        return resolve(request.response);\r\n      }\r\n      reject('Unable to load RSS');\r\n    };\r\n    request.onerror = () => {\r\n      reject('Unable to load RSS');\r\n    };\r\n    request.send(config.body);\r\n  });\r\n}\r\n\r\nfunction createGraphqlRequest(fetchKnowingCookie) {\r\n  return async (query, variables) => {\r\n    const fetchConfig = {\r\n      method: 'post',\r\n      headers: {\r\n        'Accept': 'application/json',\r\n        'Content-Type': 'application/json',\r\n      },\r\n      body: JSON.stringify({ query, variables }),\r\n      credentials: 'include',\r\n    };\r\n    const resp = await fetchKnowingCookie('/graphql', fetchConfig);\r\n    if (resp.status !== 200) {\r\n      throw new Error(resp.statusText);\r\n    }\r\n    return await resp.json();\r\n  };\r\n}\r\n\r\nfunction createFetchKnowingCookie({ cookie }) {\r\n  if (!process.env.BROWSER) {\r\n    return (url, options: IConfig = {}) => {\r\n      const isLocalUrl = /^\\/($|[^\\/])/.test(url); // eslint-disable-line no-useless-escape\r\n\r\n      // pass cookie only for itself.\r\n      // We can't know cookies for other sites BTW\r\n      if (isLocalUrl && options.credentials === 'include') {\r\n        const headers = {\r\n          ...options.headers,\r\n          Cookie: cookie,\r\n        };\r\n        return fetch(url, { ...options, headers });\r\n      }\r\n\r\n      return fetch(url, options);\r\n    };\r\n  }\r\n\r\n  return fetch;\r\n}\r\n\r\nexport default function createHelpers(config) {\r\n  const fetchKnowingCookie = createFetchKnowingCookie(config);\r\n  const graphqlRequest = createGraphqlRequest(fetchKnowingCookie);\r\n\r\n  return {\r\n    fetch: fetchKnowingCookie,\r\n    graphqlRequest,\r\n    history: config.history,\r\n  };\r\n}\r\n\n\n\n// WEBPACK FOOTER //\n// ./redux/createHelpers.ts","export const SET_LOCALE_START = 'SET_LOCALE_START';\r\nexport const SET_LOCALE_SUCCESS = 'SET_LOCALE_SUCCESS';\r\nexport const SET_LOCALE_ERROR = 'SET_LOCALE_ERROR';\r\n\n\n\n// WEBPACK FOOTER //\n// ./redux/intl/constants.ts","import * as createLogger from 'redux-logger';\r\n\r\nconst logger = createLogger({\r\n  collapsed: true,\r\n  /*stateTransformer: (state) => {\r\n    return immutableToJS(state);\r\n  },*/\r\n  predicate: (getState, { type }) => {\r\n    return type !== 'redux-form/BLUR' &&\r\n           type !== 'redux-form/CHANGE' &&\r\n           type !== 'redux-form/FOCUS' &&\r\n           type !== 'redux-form/TOUCH';\r\n  },\r\n});\r\n\r\n\r\nexport default logger;\r\n\n\n\n// WEBPACK FOOTER //\n// ./redux/logger.ts","import { routerReducer } from 'react-router-redux';\r\nimport { combineReducers } from 'redux';\r\n\r\nexport const createReducer = (asyncReducers?: any) => {\r\n  return combineReducers({\r\n    routing: routerReducer,\r\n    ...asyncReducers,\r\n  });\r\n};\r\n\r\nexport const injectAsyncReducer = (store, name, asyncReducer) => {\r\n  store.asyncReducers[name] = asyncReducer;\r\n  store.replaceReducer(createReducer(store.asyncReducers));\r\n};\r\n\n\n\n// WEBPACK FOOTER //\n// ./redux/reducers.ts","export const SET_RUNTIME_VARIABLE = 'SET_RUNTIME_VARIABLE';\r\n\n\n\n// WEBPACK FOOTER //\n// ./redux/runtime/constants.ts","import * as React from 'react';\r\n\r\ninterface IHome extends React.Props<any> {\r\n  title: String;\r\n}\r\n\r\nexport default class Home extends React.Component<IHome, void> {\r\n  constructor(props) {\r\n    super(props);\r\n  }\r\n\r\n  public render() {\r\n    return (\r\n      <div>\r\n        <h1>{this.props.title}</h1>\r\n        <p>Homepage</p>\r\n      </div>\r\n    );\r\n  }\r\n}\r\n\n\n\n// WEBPACK FOOTER //\n// ./routes/Home/Home.tsx","import * as React from 'react';\r\nimport Home from './Home';\r\n\r\nexport default {\r\n  getComponent (nextState, cb) {\r\n    cb(null, Home);\r\n  },\r\n};\r\n\r\n\n\n\n// WEBPACK FOOTER //\n// ./routes/Home/index.tsx","import * as React from 'react';\r\n\r\ninterface INotFound extends React.Props<any> {\r\n  title: String;\r\n}\r\n\r\nexport default class NotFound extends React.Component<INotFound, void> {\r\n  constructor(props) {\r\n    super(props);\r\n  }\r\n\r\n  public render() {\r\n    return (\r\n      <div>\r\n        <h1>{this.props.title}</h1>\r\n        <p>Sorry, the page you were trying to view does not exist.</p>\r\n      </div>\r\n    );\r\n  }\r\n}\r\n\n\n\n// WEBPACK FOOTER //\n// ./routes/NotFound/NotFound.tsx","import * as React from 'react';\r\nimport NotFound from './NotFound';\r\n\r\nconst title = \"Page not found\";\r\n\r\nexport default {\r\n  path: \"*\",\r\n  action() {\r\n    return {\r\n      title,\r\n      components: (<NotFound title={title} />),\r\n      status: 404,\r\n    };\r\n  },\r\n};\r\n\n\n\n// WEBPACK FOOTER //\n// ./routes/NotFound/index.tsx","module.exports = require(\"graphql\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"graphql\"\n// module id = 34\n// module chunks = 0","module.exports = require(\"react-helmet\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"react-helmet\"\n// module id = 35\n// module chunks = 0","module.exports = require(\"redux-logger\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"redux-logger\"\n// module id = 36\n// module chunks = 0","module.exports = require(\"redux-thunk\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"redux-thunk\"\n// module id = 37\n// module chunks = 0","import * as bodyParser from 'body-parser';\r\nimport * as chalk from 'chalk';\r\nimport * as cookieParser from 'cookie-parser';\r\nimport * as express from 'express';\r\nimport * as graphqlHTTP from 'express-graphql';\r\nimport * as expressJwt from 'express-jwt';\r\nimport * as helmet from 'helmet';\r\nimport * as history from 'history';\r\nimport * as jwt from 'jsonwebtoken';\r\nimport * as mongoose from 'mongoose';\r\nimport * as passport from 'passport';\r\nimport * as path from 'path';\r\nimport * as PrettyError from 'pretty-error';\r\nimport * as React from 'react';\r\nimport * as ReactDOM from 'react-dom/server';\r\nimport { Provider } from 'react-redux';\r\nimport { createMemoryHistory, match, RouterContext } from 'react-router';\r\nimport { syncHistoryWithStore } from 'react-router-redux';\r\nimport Html, { IHtmlProps } from './components/Html';\r\nimport { auth, locales, port } from './config';\r\nimport { configureStore } from './redux/configureStore';\r\nimport { setLocale } from './redux/intl/actions';\r\nimport { setRuntimeVariable } from './redux/runtime/actions';\r\nimport routes from './routes';\r\nimport ErrorPage from './routes/Error/ErrorPage';\r\n\r\nimport { root, schema } from './schema';\r\n\r\nfunction format(time) {\r\n  return time.toTimeString().replace(/.*(\\d{2}:\\d{2}:\\d{2}).*/, '$1');\r\n}\r\n\r\n/**\r\n * Express app\r\n */\r\nconst app = express();\r\n\r\n/**\r\n * Mongoose Database\r\n */\r\nmongoose.connect('mongodb://localhost/apollo', (err) => {\r\n  if (err) {\r\n    console.log(err); //  eslint-disable-line no-console\r\n    return err;\r\n  }\r\n  return true;\r\n});\r\n\r\n//\r\n// Tell any CSS tooling (such as Material UI) to use all vendor prefixes if the\r\n// user agent is not known.\r\n// -----------------------------------------------------------------------------\r\ndeclare const global: any;\r\nglobal.navigator = global.navigator || {};\r\nglobal.navigator.userAgent = global.navigator.userAgent || 'all';\r\n\r\n//\r\n// Register Node.js middleware\r\n// -----------------------------------------------------------------------------\r\napp.use(express.static(path.join(__dirname, 'public')));\r\napp.use(helmet());\r\napp.use(cookieParser());\r\napp.use(bodyParser.urlencoded({ extended: true }));\r\napp.use(bodyParser.json());\r\n\r\n//\r\n// Authentication\r\n// -----------------------------------------------------------------------------\r\napp.use(expressJwt({\r\n  secret: auth.jwt.secret,\r\n  credentialsRequired: false,\r\n  getToken: (req) => req.cookies.id_token,\r\n}));\r\napp.use(passport.initialize());\r\n\r\napp.get('/login/facebook',\r\n  passport.authenticate('facebook', { scope: ['email', 'user_location'], session: false }),\r\n);\r\napp.get('/login/facebook/callback',\r\n  passport.authenticate('facebook', { failureRedirect: '/login', session: false }),\r\n  (req, res) => {\r\n    const expiresIn = 60 * 60 * 24 * 180; // 180 days\r\n    const token = jwt.sign(req.user, auth.jwt.secret, { expiresIn });\r\n    res.cookie('id_token', token, { maxAge: 1000 * expiresIn, httpOnly: true });\r\n    res.redirect('/');\r\n  },\r\n);\r\n\r\n/**\r\n * GraphQL Initialize\r\n */\r\napp.use('/graphql', graphqlHTTP((req) => {\r\n  return {\r\n    schema,\r\n    rootValue: { request: req },\r\n    graphiql: process.env.NODE_ENV !== 'production',\r\n  };\r\n}));\r\n\r\n/**\r\n * Register server-side rendering middleware\r\n */\r\napp.get('*', async (req, res, next) => {\r\n  const location = req.url;\r\n  const memoryHistory = createMemoryHistory(req.originalUrl);\r\n  const store = configureStore({}, {\r\n    history: memoryHistory,\r\n    cookie: req.cookies,\r\n  });\r\n  const history = syncHistoryWithStore(memoryHistory, store);\r\n\r\n  store.dispatch(setRuntimeVariable({\r\n    name: 'availableLocales',\r\n    value: locales,\r\n  }));\r\n\r\n  const locale = req.acceptsLanguages(locales);\r\n  await store.dispatch(setLocale({\r\n    locale,\r\n  }));\r\n\r\n  match ({ history, routes: routes(store), location: req.url }, (error, redirectLocation, renderProps) => {\r\n    if (error) {\r\n      return res.status(500).send(error.message);\r\n    } else if (redirectLocation) {\r\n      return res.redirect(302, redirectLocation.pathname + redirectLocation.search);\r\n    } else if (renderProps) {\r\n      const data: IHtmlProps = {\r\n        title: 'React Starter Kit',\r\n        description: 'React starter kit using Typescript 2 and Webpack 2.',\r\n        children: null,\r\n        state: store.getState(),\r\n      };\r\n      const components = (\r\n        <Provider store={store} key=\"provider\">\r\n          <RouterContext history={history} {...renderProps} />\r\n        </Provider>\r\n      );\r\n\r\n      // set children to match context\r\n      data.children = ReactDOM.renderToString(components);\r\n\r\n      // rendering html components\r\n      const html = ReactDOM.renderToStaticMarkup(<Html {...data} />);\r\n\r\n      res.status(200).send(`<doctype html>${html}`);\r\n    } else {\r\n      res.status(404).send('Not found');\r\n    }\r\n  });\r\n});\r\n\r\n/**\r\n * Error handling\r\n */\r\nconst pe = new PrettyError();\r\npe.skipNodeFiles();\r\npe.skipPackage('express');\r\n\r\n\r\napp.use((err, req, res, next) => { // eslint-disable-line no-unused-vars\r\n  console.log(pe.render(err)); // eslint-disable-line no-console\r\n  const html = ReactDOM.renderToStaticMarkup(\r\n    <Html\r\n      title=\"Internal Server Error\"\r\n      description={err.message}\r\n    >\r\n      {ReactDOM.renderToString(<ErrorPage error={err} />)}\r\n    </Html>,\r\n  );\r\n  res.status(err.status || 500);\r\n  res.send(`<!doctype html>${html}`);\r\n});\r\n\r\napp.listen(port, (error: Error) => {\r\n  /* if (error) {\r\n    console.log(`%s Listening on http://localhost:${port}/`, chalk.red('[Error]'));\r\n    console.log(error);\r\n  } else {*/\r\n  console.log(`Listening on http://localhost:${port}/`);\r\n  // }\r\n});\r\n\n\n\n// WEBPACK FOOTER //\n// ./main.server.tsx","import * as React from 'react';\r\n\r\ninterface IErrorPage extends React.Props<any> {\r\n  error: { name, message, stack };\r\n}\r\n\r\nclass ErrorPage extends React.Component<IErrorPage, void> {\r\n  public render() {\r\n    if (process.env.NODE_ENV !== 'production') {\r\n      const { error } = this.props;\r\n      return (\r\n        <div>\r\n          <h1>{error.name}</h1>\r\n          <p>{error.message}</p>\r\n          <pre>{error.stack}</pre>\r\n        </div>\r\n      );\r\n    }\r\n\r\n    return (\r\n      <div>\r\n        <h1>Error</h1>\r\n        <p>Sorry, a critical error occurred on this page.</p>\r\n      </div>\r\n    );\r\n  }\r\n}\r\n\r\nexport default ErrorPage;\r\n\n\n\n// WEBPACK FOOTER //\n// ./routes/Error/ErrorPage.tsx"],"mappings":";;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;AChEA;;;;;;ACAA;;;;;;;;;ACAA;AACA;AAEA;AACA;AAEA;AAEA;AACA;AACA;AADA;AAHA;AASA;AAEA;AAEA;AACA;AACA;AACA;AAFA;AAKA;AACA;AACA;AACA;AAFA;AAKA;AACA;AACA;AACA;AAFA;AAjBA;;;;;;ACfA;;;;;;;;;ACAA;AACA;AACA;AASA;AACA;AACA;AAoCA;;AAEA;;;;;;;;;ACnDA;AAEA;AACA;AACA;AAEA;AACA;AAYA;AACA;AAKA;AACA;AACA;AAEA;AAIA;AAQA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AAhCA;AAgCA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;ACnDA;AAMA;;;;;;;;AASA;AACA;AACA;AACA;AACA;AACA;AADA;AAFA;AAOA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAFA;AAFA;AAQA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAFA;AAFA;AAOA;AACA;AAEA;AACA;AACA;AAzCA;;;;;;;;;ACfA;AAEA;AACA;AACA;AACA;AACA;AACA;AAFA;AAFA;AAOA;AARA;;;;;;;;;ACAA;AACA;AACA;;AAEA;;;;AAKA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AANA;AAUA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;;;;;;;;;;ACjCA;AAEA;;;;AAAA;AAYA;AANA;AACA;AACA;AACA;AAHA;AAMA;;;;;;ACdA;;;;;;ACAA;;;;;;ACAA;;;;;;ACAA;;;;;;ACAA;;;;;;ACAA;;;;;;ACAA;;;;;;ACAA;;;;;;ACAA;;;;;;ACAA;;;;;;ACAA;;;;;;ACAA;;;;;;ACAA;;;;;;ACAA;;;;;;;;;ACAA;AAEA;AAKA;AACA;AAMA;;AAXA;AACA;AADA;;AAcA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;ACRA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AAFA;AAIA;AACA;AAPA;AASA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAIA;AACA;AAEA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AAHA;AAKA;;AATA;;;;;;;;;ACzEA;AACA;;;;;;;;;;ACDA;AAEA;AACA;AACA;;;AAGA;AACA;AAIA;AAVA;;AAcA;;;;;;;;;;;;;;;;AChBA;AACA;AAEA;AACA;AAIA;AAEA;AACA;AACA;;;;;;;;;;ACZA;;;;;;;;;ACAA;AAMA;AACA;AACA;AACA;AAEA;AACA;AAMA;;;AAZA;;;;;;;;;ACLA;;AAEA;AACA;AACA;AACA;AAHA;;;;;;;;;ACHA;AAMA;AACA;AACA;AACA;AAEA;AACA;AAMA;;;AAZA;;;;;;;;;ACNA;AACA;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AAHA;AAKA;AARA;;;;;;ACLA;;;;;;ACAA;;;;;;ACAA;;;;;;ACAA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;ACAA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AAEA;AACA;AACA;AAEA;;;AAGA;AAEA;;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AAOA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AAHA;AAKA;AAEA;AAGA;AAGA;AACA;AACA;AACA;AACA;AAGA;;;AAGA;AACA;AACA;AACA;AACA;AAHA;AAKA;AAEA;;;AAGA;AACA;AACA;AACA;AACA;AACA;AAFA;AAIA;AAEA;AACA;AACA;AAFA;AAKA;AACA;AACA;AADA;AAIA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAJA;AAMA;AAMA;AACA;AAEA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAEA;;;AAGA;AACA;AACA;AAGA;AACA;AACA;AAQA;AACA;AACA;AAEA;AACA;;;;AAIA;AACA;;;;;;;;;;ACpLA;AAMA;AACA;AACA;AACA;AACA;AAOA;AAEA;AAMA;;;AAGA;;;","sourceRoot":""}